<h1 class="app-main-title">IpInfoTest</h1>

<div class="grid md:grid-cols-2 gap-2">
  <div class="card">
    <div class="card-header">
      IP lookup
    </div>
    <div class="card-body">
      <form method="get" action="ipinfotest" class="flex gap-2 items-end">
        <div class="flex-1">
          <label class="form-label">IP adresa</label>
          <input
            class="form-control"
            type="text"
            name="ip"
            value="{{ viewParams.ip|e }}"
            placeholder="napr. 8.8.8.8"
          />
          <small class="text-muted">Zadaj IPv4/IPv6 a odošli.</small>
        </div>

        <button class="btn btn-primary" type="submit">
          <span class="icon"><i class="fas fa-search"></i></span>
          <span class="text">Vyhľadať</span>
        </button>
      </form>

      {% if viewParams.error %}
        <div class="alert alert-danger mt-3">
          {{ viewParams.error }}
        </div>
      {% endif %}

      {% if viewParams.result %}
        <div class="alert alert-success mt-3">
          Údaje pre IP <b>{{ viewParams.ip }}</b> boli načítané.
        </div>
      {% endif %}
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      Výsledok
    </div>
    <div class="card-body">
      {% if not viewParams.result %}
        <div class="alert alert-info">
          Zatiaľ nemáš výsledok. Zadaj IP a klikni “Vyhľadať”.
        </div>
      {% else %}
        {# Summary – zobraz len ak existujú #}
        <div class="mb-3">
          <div><b>Country:</b> {{ viewParams.result.country ?? '-' }}</div>
          <div><b>City:</b> {{ viewParams.result.city ?? '-' }}</div>
          <div><b>Region:</b> {{ viewParams.result.region ?? '-' }}</div>

          {% set tz = viewParams.result.timezone ?? null %}
          <div><b>Timezone:</b>
            {% if tz is iterable %}
              {{ tz.id ?? '-' }}
            {% else %}
              {{ tz ?? '-' }}
            {% endif %}
          </div>

          {% set conn = viewParams.result.connection ?? null %}
          <div><b>ISP:</b>
            {% if conn is iterable %}
              {{ conn.isp ?? (conn.org ?? '-') }}
            {% else %}
              {{ viewParams.result.isp ?? '-' }}
            {% endif %}
          </div>
        </div>

        <hr/>

        <div class="table-responsive mt-3">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Kľúč</th>
                <th>Hodnota</th>
              </tr>
            </thead>
            <tbody>
              {% for k, v in viewParams.result %}
                <tr>
                  <td><code>{{ k }}</code></td>
                  <td>
                    {% if v is iterable %}
                      <pre style="white-space: pre-wrap; margin: 0;">{{ v|json_encode(constant('JSON_PRETTY_PRINT')) }}</pre>
                    {% else %}
                      {{ v }}
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}
    </div>
  </div>
</div>

{# DO NOT DELETE FOLLOWING LINE, OR `php hubleto` WILL NOT GENERATE CODE HERE #}
{# @hubleto-cli:buttons #}
<a class='btn btn-large btn-square btn-transparent' href='ipinfotest/favorite-ips'>
<span class='icon'><i class='fas fa-table'></i></span>
<span class='text'>FavoriteIps</span>
</a>
